# Internationalization (i18n) System

This document describes the i18n content management system for the Legacy Concierge website.

## Overview

The i18n system provides multi-language support using JSON locale files and a template syntax that integrates seamlessly with the vanilla Web Components architecture.

## Key Concepts

| Concept | Description |
|---------|-------------|
| Locale Source | `<html lang="...">` attribute determines which locale to load |
| Template Syntax | `${key.path}` in component attributes |
| Resolution Time | Component `connectedCallback` via `getAttr()` |
| Fallback | English (`en`) is the default fallback locale |

## Directory Structure

```
src/i18n/
  index.js              # I18nService singleton
  locales/
    en/
      common.json       # Shared strings (nav, footer, buttons)
      pages/
        home.json       # Homepage content
        about.json      # About page content
        ...
    es/
      common.json
      pages/
        home.json
        ...
    meta.json           # Language metadata

public/i18n/
  locales/              # Runtime-accessible copies of locale files
    en/
    es/
    meta.json
```

## Template Syntax

Use `${key.path}` in component attributes to reference translations:

```html
<!-- Before (hardcoded) -->
<hero-banner
    heading="YOUR HEALTH, OUR PURPOSE."
    description="Refining Private Nursing..."
></hero-banner>

<!-- After (i18n) -->
<hero-banner
    heading="${pages.home.hero.heading}"
    description="${pages.home.hero.description}"
></hero-banner>
```

The `getAttr()` method in `BaseComponent` automatically detects and resolves these keys.

## JSON File Structure

### Key Naming Convention

Keys use dot-notation organized by namespace:

- `pages.{pageName}.{section}.{key}` - Page-specific content
- `common.{category}.{key}` - Shared UI strings

### Example: common.json

```json
{
    "nav": {
        "home": "Home",
        "services": "Services",
        "about": "About"
    },
    "buttons": {
        "learnMore": "Learn More",
        "submit": "Submit"
    },
    "footer": {
        "copyright": "2024 Legacy Concierge. All rights reserved."
    }
}
```

### Example: pages/home.json

```json
{
    "hero": {
        "heading": "YOUR HEALTH, OUR PURPOSE.",
        "description": "Refining Private Nursing...",
        "primaryCta": "CALL FOR MORE INFO",
        "secondaryCta": "Learn More"
    },
    "intro": {
        "tagline": "Your Longevity is part of our",
        "description": "Legacy Concierge delivers..."
    }
}
```

## How to Add a New Language

1. Create the locale folder:
   ```bash
   mkdir -p src/i18n/locales/{locale}/pages
   mkdir -p public/i18n/locales/{locale}/pages
   ```

2. Copy English files as templates:
   ```bash
   cp src/i18n/locales/en/common.json src/i18n/locales/{locale}/
   cp src/i18n/locales/en/pages/*.json src/i18n/locales/{locale}/pages/
   ```

3. Translate all strings in the copied files

4. Update `meta.json` to include the new locale:
   ```json
   {
       "locales": {
           "en": { "name": "English", "nativeName": "English" },
           "es": { "name": "Spanish", "nativeName": "Español" },
           "fr": { "name": "French", "nativeName": "Français" }
       }
   }
   ```

5. Update `I18nService.#isValidLocale()` in `src/i18n/index.js`:
   ```javascript
   const supportedLocales = ["en", "es", "fr"];
   ```

6. Copy to public directory:
   ```bash
   cp -r src/i18n/locales/{locale} public/i18n/locales/
   ```

## How to Add Translations for a New Page

1. Create the page JSON file:
   ```bash
   touch src/i18n/locales/en/pages/{pagename}.json
   ```

2. Structure your content:
   ```json
   {
       "hero": {
           "heading": "Page Title",
           "description": "Page description..."
       },
       "sections": {
           "feature1": {
               "title": "Feature Title",
               "description": "Feature description..."
           }
       }
   }
   ```

3. Copy to other locale folders and translate

4. Copy to public directory:
   ```bash
   cp src/i18n/locales/*/pages/{pagename}.json public/i18n/locales/*/pages/
   ```

5. Update HTML to use template syntax:
   ```html
   <hero-banner
       heading="${pages.{pagename}.hero.heading}"
       description="${pages.{pagename}.hero.description}"
   ></hero-banner>
   ```

## How `<html lang>` Affects Loading

The I18nService reads `document.documentElement.lang` to determine which locale files to load:

1. Page loads with `<html lang="es">`
2. `main.js` initializes i18n
3. I18nService loads:
   - `/i18n/locales/es/common.json`
   - `/i18n/locales/es/pages/{currentPage}.json`
4. Components mount and call `getAttr()`
5. `getAttr()` detects `${...}` and resolves via `i18n.t()`

## Language Switching

To switch languages, use the `?lang=` query parameter:

```html
<a href="?lang=es">Español</a>
<a href="?lang=en">English</a>
```

Or use the `<ui-language-switcher>` component:

```html
<!-- Dropdown style -->
<ui-language-switcher></ui-language-switcher>

<!-- Links style (EN | ES) -->
<ui-language-switcher variant="links"></ui-language-switcher>
```

The I18nService checks for `?lang=` query parameter and updates `<html lang>` accordingly.

## Interpolation

Use `{{variable}}` placeholders for dynamic values:

```json
{
    "greeting": "Hello, {{name}}!",
    "itemCount": "You have {{count}} items"
}
```

```javascript
// In component
const text = this.getAttr("greeting", "", { name: "John" });
// Result: "Hello, John!"
```

## API Reference

### I18nService

```javascript
import { i18n, t } from "./i18n/index.js";

// Initialize (called once in main.js)
await i18n.initialize();

// Get current locale
const locale = i18n.locale; // "en"

// Check if ready
const ready = i18n.ready; // true

// Translate a key
const text = i18n.t("common.buttons.submit"); // "Submit"

// With interpolation
const greeting = i18n.t("common.greeting", { name: "John" });

// Change locale (triggers page reload)
await i18n.setLocale("es");

// Subscribe to locale changes
const unsubscribe = i18n.subscribe((locale) => {
    console.log("Language changed to:", locale);
});
```

### BaseComponent.getAttr()

```javascript
// Automatically resolves ${key} syntax
const heading = this.getAttr("heading", "Default Value");

// With interpolation parameters
const greeting = this.getAttr("greeting", "Hello", { name: "John" });
```

## Browser Translate Behavior

- `<html lang="es">` tells browsers the page is in Spanish
- Browsers won't prompt to translate to Spanish if user's browser is set to Spanish
- Browsers will prompt to translate from Spanish if user's browser is set to English
- This is correct semantic behavior per HTML5 spec

## Build Considerations

### Development

Locale files are served from `public/i18n/locales/` during development via Vite's dev server.

### Production

1. Ensure locale files are copied to `public/i18n/locales/` before build
2. Vite will include them in the `dist/` output

### Sync Script

Create a sync script to keep source and public in sync:

```bash
#!/bin/bash
# bin/sync-i18n.sh
cp -r src/i18n/locales/* public/i18n/locales/
echo "i18n locales synced to public/"
```
